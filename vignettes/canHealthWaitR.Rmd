---
title: "canHealthWaitR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{canHealthWaitR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE
)
```

```{r}
# Load packages
library(canHealthWaitR)
```

```{r}
ls("package:canHealthWaitR")
```

## Overview

`canHealthWaitR` is an R package that wraps Statistics Canada's Web Data Service (WDS) and provides a lightweight workflow to:

1.  discover curated health access / wait time tables,

2.  download and read the data,

3.  standardize the structure into a consistent schema,

4.  generate quick plots for reporting and exploration.

The package currently focuses on a curated set of three tables (each with a data CSV and a metadata CSV), which are sufficient for demonstrating a complete API-to-plot workflow.

------------------------------------------------------------------------

## 1. Discover curated tables

```{r}
mw_list_tables()
```

You can resolve a table using its `table_key` (recommended) or a `product_id`.

```{r}
tbl <- mw_resolve_table("wait_time")
tbl
```

---

## 2. Download and read a table

```{r}
pid <- tbl$product_id[[1]]
raw <- mw_read_data(pid)
glimpse(raw)
```

---

## 3. Standardize into a consistent schema

Different StatCan tables vary in dimension names and encodings. `mw_standardize()` harmonizes column names and returns a consistent structure that downstream functions can rely on.

```{r}
std <- mw_standardize(raw, table_id = pid)
glimpse(std)
```

---

## 4. Example visualizations

### 4.1 Trend view (generic)

A generic trend plot is useful once you have `ref_date` and `value` fields available.\
Below is a minimal example filtered to a single statistic/indicator for plotting.

```{r}
df_trend <- std %>%
  filter(
    ref_date == 2024,
    !is.na(value),
    is.finite(value)
  ) %>%
  head(50)

mw_plot_trend(df_trend)
```

### 4.2 People affected by wait times (province comparison)

This plot uses a package-provided helper designed for the standardized schema.

```{r warning=FALSE}
mw_plot_affected_province(std, year = 2024)
```

### 4.3 Satisfaction distribution (stacked)

```{r warning=FALSE}
mw_plot_satisfaction_stack(std, year = 2024)
```

### 4.4 Wait duration distribution (stacked)

```{r}
mw_plot_wait_duration_stack(std, year = 2024)
```

---

### Notes

-   At the time of writing, the curated tables provide complete data for 2024.

-   As more years become available, the same workflow can be extended to time-series comparisons without changing the user-facing API.
